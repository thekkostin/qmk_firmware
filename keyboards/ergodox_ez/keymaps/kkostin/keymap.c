#include "ergodox_ez.h"
#include "version.h"

#include "kkostin.h"

#define L_MOD(kc) LT(MODIFIERS_LEFT, kc)
#define R_MOD(kc) LT(MODIFIERS_RIGHT, kc)

#define L_GUI(kc) LT(GUI_LEFT, kc)
#define R_GUI(kc) LT(GUI_RIGHT, kc)

#define NPAD(kc) LT(NUM_PAD, kc)
#define FPAD(kc) LT(FNUM_PAD, kc)

#define SMBLS(kc) LT(SYMBOLS, kc)

#define ARWS(kc) LT(ARROWS_AND_FUNCTIONAL, kc)

#define LANG1 LGUI(LCTL(KC_1))
#define LANG2 RGUI(RCTL(KC_2))


const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
/* Keymap 0: Basic layer
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |   ~    |   1  |   2  |   3  |   4  |   5  |      |           |      |   6  |   7  |   8  |   9  |   0  |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * | TAB    |   Q  |   W  |   E  |   R  |   T  |  (   |           |  )   |   Y  |   U  |   I  |   O  |   P  |   \    |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * | ESC    | LM/A |   S  |   D  |   F  |   G  |------|           |------|   H  |   J  |   K  |   L  | RM/; |   '    |
 * |--------+------+------+------+------+------|LANG1 |           | LANG2|------+------+------+------+------+--------|
 * | LShift | LF/Z |LGUI/X|   C  |   V  |   B  |      |           |      |   N  |   M  |   ,  |LGUI/.| RF// | RShift |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      | Left | Right|                                       | Down |  Up  |   [  |   ]  |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,---------------.
 *                                        | CAPS |      |       |      |  CAPS  |
 *                                 ,------|------|------|       |------+--------+------.
 *                                 |      |      |      |       |      |        |      |
 *                                 | Space|Backsp|------|       |------| Delete |Enter |
 *                                 |      |ace   |      |       |      |        |      |
 *                                 `--------------------'       `----------------------'
 */
[BASE] = LAYOUT_ergodox_pretty(

  KC_GRAVE,        KC_1,        KC_2,          KC_3,    KC_4,          KC_5,    XXXXXXX,             XXXXXXX,      KC_6,    KC_7,           KC_8,    KC_9,              KC_0,       _______,
  KC_TAB,          KC_Q,        KC_W,          KC_E,    KC_R,          KC_T,    KC_LPRN,             KC_RPRN,      KC_Y,    KC_U,           KC_I,    KC_O,              KC_P,       KC_BSLS,
  KC_ESC,          L_MOD(KC_A), KC_S,          KC_D,    ARWS(KC_F),    KC_G,                                       KC_H,    KC_J,           KC_K,    KC_L,          R_MOD(KC_SCLN), KC_QUOT,
  KC_LSFT,         NPAD(KC_Z),  L_GUI(KC_X),   KC_C,    KC_V,          KC_B,    LANG1,                 LANG2,      KC_N,    SMBLS(KC_M),    KC_COMM, R_GUI(KC_DOT), FPAD(KC_SLSH),  KC_RSFT,
  XXXXXXX,         XXXXXXX,     XXXXXXX,       KC_LEFT, KC_RGHT,                                                            KC_DOWN,        KC_UP,   KC_LBRC,           KC_RBRC,    XXXXXXX,
                                                                       KC_CAPS, XXXXXXX,             XXXXXXX, KC_CAPS,
                                                                                XXXXXXX,             XXXXXXX,
                                                               KC_SPC, KC_BSPC, XXXXXXX,             XXXXXXX, KC_DEL, KC_ENT
),
    
/* Layer with modifiers left
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        | BASE | LALT |LCTRL | LSFT |      |------|           |------|      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,---------------.
 *                                        |      |      |       |      |        |
 *                                 ,------|------|------|       |------+--------+------.
 *                                 |      |      |      |       |      |        |      |
 *                                 |      |      |------|       |------|        |      |
 *                                 |      |      |      |       |      |        |      |
 *                                 `--------------------'       `----------------------'
 */
[MODIFIERS_LEFT] = LAYOUT_ergodox_pretty(

  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    KC_LALT,    KC_LCTL,    KC_LSFT,    _______,                                     _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,                                                             _______,    _______,    _______,    _______,    _______,
                                                                _______,  _______,             _______,  _______,
                                                                          _______,             _______,
                                                      _______,  _______,  _______,             _______,  _______,  _______
),
    
/* Layer with modifiers right
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |------|           |------|      | RSFT | RCTRL| RALT | BASE |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,---------------.
 *                                        |      |      |       |      |        |
 *                                 ,------|------|------|       |------+--------+------.
 *                                 |      |      |      |       |      |        |      |
 *                                 |      |      |------|       |------|        |      |
 *                                 |      |      |      |       |      |        |      |
 *                                 `--------------------'       `----------------------'
 */
[MODIFIERS_RIGHT] = LAYOUT_ergodox_pretty(

  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,                                     _______,    KC_RSFT,    KC_RCTL,    KC_RALT,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,                                                             _______,    _______,    _______,    _______,    _______,
                                                                _______,  _______,             _______,  _______,
                                                                          _______,             _______,
                                                      _______,  _______,  _______,             _______,  _______,  _______
),
    
/* Layer with modifiers left
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |------|           |------|      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        | LALT |B/GUI |LCTRL | LSFT |      |      |           |      |      |      |      |      |      |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,---------------.
 *                                        |      |      |       |      |        |
 *                                 ,------|------|------|       |------+--------+------.
 *                                 |      |      |      |       |      |        |      |
 *                                 |      |      |------|       |------|        |      |
 *                                 |      |      |      |       |      |        |      |
 *                                 `--------------------'       `----------------------'
 */
[GUI_LEFT] = LAYOUT_ergodox_pretty(

  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,                                     _______,    _______,    _______,    _______,    _______,    _______,
  _______,    KC_LALT,    _______,    KC_LCTL,    KC_LSFT,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,                                                             _______,    _______,    _______,    _______,    _______,
                                                                _______,  _______,             _______,  _______,
                                                                          _______,             _______,
                                                      _______,  _______,  _______,             _______,  _______,  _______
),
    
/* Layer with modifiers right
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |------|           |------|      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      | RSFT | RCTRL|B/GUI | RALT |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,---------------.
 *                                        |      |      |       |      |        |
 *                                 ,------|------|------|       |------+--------+------.
 *                                 |      |      |      |       |      |        |      |
 *                                 |      |      |------|       |------|        |      |
 *                                 |      |      |      |       |      |        |      |
 *                                 `--------------------'       `----------------------'
 */
[GUI_RIGHT] = LAYOUT_ergodox_pretty(

  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,                                     _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    KC_RSFT,    KC_RCTL,    _______,    KC_RALT,    _______,
  _______,    _______,    _______,    _______,    _______,                                                             _______,    _______,    _______,    _______,    _______,
                                                                _______,  _______,             _______,  _______,
                                                                          _______,             _______,
                                                      _______,  _______,  _______,             _______,  _______,  _______
),

/* Arrows and functional keys
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      | Ins  | Home | PgUp |      |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      | Del  | End  | PgDn |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        | LALT |LCTRL | LSFT | BASE |      |------|           |------| Left | Down |  Up  |Right |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |  {   |  }   |  (   |  )   |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,---------------.
 *                                        |      |      |       |      |        |
 *                                 ,------|------|------|       |------+--------+------.
 *                                 |      |      |      |       |      |        |      |
 *                                 |      |      |------|       |------|        |      |
 *                                 |      |      |      |       |      |        |      |
 *                                 `--------------------'       `----------------------'
 */
[ARROWS_AND_FUNCTIONAL] = LAYOUT_ergodox_pretty(

  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    KC_INS,     KC_HOME,    KC_PGUP,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    KC_DELT,    KC_END,     KC_PGDN,    _______,    _______,
  _______,    KC_LALT,    KC_LCTL,    KC_LSFT,    _______,    _______,                                     KC_LEFT,    KC_DOWN,    KC_UP,      KC_RGHT,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    KC_LCBR,    KC_RCBR,    KC_LPRN,    KC_RPRN,    _______,
  _______,    _______,    _______,    _______,    _______,                                                             _______,    _______,    _______,    _______,    _______,
                                                                _______,  _______,             _______,  _______,
                                                                          _______,             _______,
                                                      _______,  _______,  _______,             _______,  _______,  _______
),
    
/* Symbols
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |  <   |  >   |  _   |  +   |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |  {   |  }   |  -   |  =   |      |------|           |------|      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |  [   |  ]   |  (   |  )   |      |      |           |      |      | BASE | RSFT | RCTRL| RALT |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,---------------.
 *                                        |      |      |       |      |        |
 *                                 ,------|------|------|       |------+--------+------.
 *                                 |      |      |      |       |      |        |      |
 *                                 |      |      |------|       |------|        |      |
 *                                 |      |      |      |       |      |        |      |
 *                                 `--------------------'       `----------------------'
 */
[SYMBOLS] = LAYOUT_ergodox_pretty(

  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    KC_LABK,    KC_RABK,    KC_UNDS,    KC_PLUS,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    KC_LCBR,    KC_RCBR,    KC_MINS,    KC_EQL,     _______,                                     _______,    _______,    _______,    _______,    _______,    _______,
  _______,    KC_LBRC,    KC_RBRC,    KC_LPRN,    KC_RPRN,    _______,    _______,             _______,    _______,    _______,    KC_RSFT,    KC_RCTL,    KC_RALT,    _______,
  _______,    _______,    _______,    _______,    _______,                                                             _______,    _______,    _______,    _______,    _______,
                                                                _______,  _______,             _______,  _______,
                                                                          _______,             _______,
                                                      _______,  _______,  _______,             _______,  _______,  _______
),
    


/* Num pad
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      |      |  /   |  *   |  -   |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |  7   |  8   |  9   |  +   |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |------|           |------|      |  4   |  5   |  6   |  +   |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        | BASE | LALT |LCTRL | LSFT |      |      |           |      |      |  1   |  2   |  3   |Enter |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |  0   |  0   |  .   |Enter |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,---------------.
 *                                        |      |      |       |      |        |
 *                                 ,------|------|------|       |------+--------+------.
 *                                 |      |      |      |       |      |        |      |
 *                                 |      |      |------|       |------|        |      |
 *                                 |      |      |      |       |      |        |      |
 *                                 `--------------------'       `----------------------'
 */
[NUM_PAD] = LAYOUT_ergodox_pretty(

  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    KC_SLSH,    KC_ASTR,    KC_MINS,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    KC_7,       KC_8,       KC_9,       KC_PLUS,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,                                     _______,    KC_4,       KC_5,       KC_6,       KC_PLUS,    _______,
  _______,    _______,    KC_LALT,    KC_LCTL,    KC_LSFT,    _______,    _______,             _______,    _______,    KC_1,       KC_2,       KC_3,       KC_ENTER,   _______,
  _______,    _______,    _______,    _______,    _______,                                                             KC_0,       KC_0,       KC_DOT,     KC_ENTER,   _______,
                                                                _______,  _______,             _______,  _______,
                                                                          _______,             _______,
                                                      _______,  _______,  _______,             _______,  _______,  _______
),



/* Function keys
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |  F9  |  F10 |  F11 |  F12 |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |  F5  |  F6  |  F7  |  F8  |      |------|           |------|      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |  F1  |  F2  |  F3  |  F4  |      |      |           |      |      | RSFT | RCTRL| RALT | BASE |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,---------------.
 *                                        |      |      |       |      |        |
 *                                 ,------|------|------|       |------+--------+------.
 *                                 |      |      |      |       |      |        |      |
 *                                 |      |      |------|       |------|        |      |
 *                                 |      |      |      |       |      |        |      |
 *                                 `--------------------'       `----------------------'
 */
[FNUM_PAD] = LAYOUT_ergodox_pretty(

  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    KC_F9,      KC_F10,     KC_F11,     KC_F12,     _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    KC_F5,      KC_F6,      KC_F7,      KC_F8,      _______,                                     _______,    _______,    _______,    _______,    _______,    _______,
  _______,    KC_F1,      KC_F2,      KC_F3,      KC_F4,      _______,    _______,             _______,    _______,    KC_RSFT,    KC_RCTL,    KC_RALT,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,                                                             _______,    _______,    _______,    _______,    _______,
                                                                _______,  _______,             _______,  _______,
                                                                          _______,             _______,
                                                      _______,  _______,  _______,             _______,  _______,  _______
),

/* Fully transparent layer
 *
 * ,--------------------------------------------------.           ,--------------------------------------------------.
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+-------------|           |------+------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |------|           |------|      |      |      |      |      |        |
 * |--------+------+------+------+------+------|      |           |      |------+------+------+------+------+--------|
 * |        |      |      |      |      |      |      |           |      |      |      |      |      |      |        |
 * `--------+------+------+------+------+-------------'           `-------------+------+------+------+------+--------'
 *   |      |      |      |      |      |                                       |      |      |      |      |      |
 *   `----------------------------------'                                       `----------------------------------'
 *                                        ,-------------.       ,---------------.
 *                                        |      |      |       |      |        |
 *                                 ,------|------|------|       |------+--------+------.
 *                                 |      |      |      |       |      |        |      |
 *                                 |      |      |------|       |------|        |      |
 *                                 |      |      |      |       |      |        |      |
 *                                 `--------------------'       `----------------------'
 */
[FULLY_TRANSPARENT] = LAYOUT_ergodox_pretty(

  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,                                     _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,    _______,    _______,             _______,    _______,    _______,    _______,    _______,    _______,    _______,
  _______,    _______,    _______,    _______,    _______,                                                             _______,    _______,    _______,    _______,    _______,
                                                                _______,  _______,             _______,  _______,
                                                                          _______,             _______,
                                                      _______,  _______,  _______,             _______,  _______,  _______
),
};

void toggle_gui_left_layer(const bool enable) {
    if (enable) {
        register_code(KC_LGUI);
    } else {
        unregister_code(KC_LGUI);
    }
}

void toggle_gui_right_layer(const bool enable) {
    if (enable) {
        register_code(KC_RGUI);
    } else {
        unregister_code(KC_RGUI);
    }
}

layer_state_t layer_state_set_user(layer_state_t state) {
    const bool gui_left_changed = (layer_state ^ state) & (1UL << GUI_LEFT);
    if (gui_left_changed) {
        const bool gui_left_enabled = state & (1UL << GUI_LEFT);
        toggle_gui_left_layer(gui_left_enabled);
    }
    const bool gui_right_changed = (layer_state ^ state) & (1UL << GUI_RIGHT);
    if (gui_right_changed) {
        const bool gui_right_enabled = state & (1UL << GUI_RIGHT);
        toggle_gui_right_layer(gui_right_enabled);
    }
    
    switch (get_highest_layer(state)) {
        case BASE:
            ergodox_right_led_1_off();
            ergodox_right_led_2_off();
            ergodox_right_led_3_off();
            break;
        case MODIFIERS_LEFT:
        case NUM_PAD:
        case GUI_LEFT:
            ergodox_right_led_1_on();
            ergodox_right_led_2_off();
            ergodox_right_led_3_off();
            break;
        case MODIFIERS_RIGHT:
        case FNUM_PAD:
        case GUI_RIGHT:
        case SYMBOLS:
            ergodox_right_led_1_off();
            ergodox_right_led_2_off();
            ergodox_right_led_3_on();
            break;
        case ARROWS_AND_FUNCTIONAL:
            ergodox_right_led_1_off();
            ergodox_right_led_2_on();
            ergodox_right_led_3_off();
    }
    return state;
}
